# План реализации задачи

## Цели:
1.  Перевести базу данных с SQLite на PostgreSQL (версия 15).
2.  Обеспечить сохранение данных PostgreSQL с помощью Docker Volumes.
3.  Унифицировать Docker-инфраструктуру, используя Docker Compose.
4.  Упростить существующие Dockerfile'ы.
5.  Удалить избыточного пользователя `appuser` из `backend/Dockerfile`.

## Подробный план действий:

1.  **Обновление `docker-compose.yml`**:
    *   Добавить новый сервис `db` для PostgreSQL 15.
    *   Настроить переменные окружения для сервиса `db` (например, `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`).
    *   Определить Docker Volume для сохранения данных PostgreSQL.
    *   Обновить сервис `backend`:
        *   Изменить переменную окружения `DATABASE_URL` для подключения к новому сервису PostgreSQL.
        *   Добавить зависимость `depends_on` от сервиса `db`.
        *   Удалить существующий `volumes: - task_data:/app/data`, так как SQLite больше не будет использоваться.
    *   Удалить определение `task_data` из глобальной секции `volumes`.

2.  **Упрощение `backend/Dockerfile`**:
    *   Удалить все строки, связанные с созданием системного пользователя и группы (`addgroup`, `adduser`).
    *   Удалить строки, изменяющие права владения директорий (`chown`).
    *   Удалить команду `USER appuser`.
    *   Удалить команды `mkdir -p data` и `mkdir -p instance`, так как они не будут нужны для работы с PostgreSQL.

3.  **Проверка `frontend/Dockerfile.frontend`**:
    *   Проверить этот файл на предмет необходимости изменений. Исходя из текущего содержимого, он уже достаточно прост и не содержит избыточных пользователей, поэтому, скорее всего, изменения не потребуются.

4.  **Обновление конфигурации бэкенда для PostgreSQL**:
    *   Изучить файлы в директории `backend/` (в частности, `backend/config.py` и `backend/database.py`) для определения текущих настроек базы данных.
    *   Внести необходимые изменения в код бэкенда для корректного использования PostgreSQL вместо SQLite. Это будет включать обновление строки подключения к базе данных и, возможно, адаптацию ORM (если используется SQLAlchemy, изменения будут минимальными).

## Mermaid Диаграмма потока выполнения задачи:

```mermaid
graph TD
    A[Начало задачи] --> B{Сбор информации};
    B --> C[Прочитать docker-compose.yml];
    B --> D[Прочитать backend/Dockerfile];
    B --> E[Прочитать frontend/Dockerfile.frontend];
    C & D & E --> F{Уточняющие вопросы к пользователю};
    F --> G[Получить ответы на вопросы];
    G --> H[Составить подробный план];
    H --> I{Предложить план пользователю на утверждение};
    I -- План утвержден --> J[Записать план в PLAN.md];
    I -- Требуются изменения --> H;
    J --> K[Предложить переключиться в режим Code для реализации];
    K --> L[Конец задачи];