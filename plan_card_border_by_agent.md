# План реализации: Рамка для карточек по исполнителю

**Цель**: Добавить рамку к карточкам (`Card.jsx`) на доске, цвет которой будет зависеть от назначенного исполнителя, с возможностью хранения цвета в базе данных.

**Предположения**:

*   На бэкенде уже есть таблица `Agent` с информацией об агентах (исполнителях).
*   `assigned_agent_id` в модели `Card` корректно ссылается на `Agent.id`.
*   `Card.to_dict()` уже возвращает `assigned_agent_name`.

**Шаги реализации**:

1.  **Бэкенд: Обновление модели `Agent`**
    *   Прочитать файл `backend/models/agent.py`.
    *   Добавить новое поле `color` (тип `db.Text`, `nullable=True`) в модель `Agent`.
    *   Обновить метод `to_dict()` в модели `Agent`, чтобы он включал новое поле `color`.

2.  **Бэкенд: Обновление API и сервисов `Agent`**
    *   Прочитать файлы `backend/api/agents.py` и `backend/services/agent_service.py`.
    *   Добавить возможность создания/обновления агентов с указанием цвета через соответствующие эндпоинты и методы сервиса.

3.  **Бэкенд: Обновление API `Card` (проверка)**
    *   Убедиться, что при получении карточек (`CardService.get_cards_by_column` и `CardService.get_card_by_id`), информация об агенте (включая цвет) корректно передается. Поскольку `Card.to_dict()` уже использует `self.assigned_agent.name`, и мы обновим `Agent.to_dict()`, это должно произойти автоматически.

4.  **Фронтенд: Обновление компонента `Card.jsx`**
    *   Изменить компонент `Card.jsx` для приема нового пропса `assignedAgentColor`.
    *   В `StyledCard` добавить логику для динамического определения цвета рамки на основе `assignedAgentColor`.
    *   Добавить стили для рамки: `border-left: 3px solid var(--assigned-agent-color, #ccc);` (используем CSS-переменную для цвета и дефолтный серый, если цвет не задан).

5.  **Фронтенд: Обновление компонента `Column.jsx`**
    *   Компонент `Column.jsx` отвечает за рендеринг `Card.jsx`. Необходимо убедиться, что при передаче пропсов в `Card.jsx` передается также `assigned_agent_color` из объекта `card`.

6.  **Фронтенд: Определение стандартных цветов (если цвет не задан в БД)**
    *   В `Card.jsx` или `theme.js` можно определить маппинг для стандартных цветов, если `assignedAgentColor` не приходит из бэкенда (например, для агентов, у которых цвет еще не задан). Однако, поскольку мы добавляем поле в БД, предпочтительнее, чтобы цвет всегда приходил из БД. Если цвет не задан, будет использоваться дефолтный цвет, указанный в CSS.

## Визуализация обновленного плана

```mermaid
graph TD
    A[Пользовательский запрос: Рамка для карточек по исполнителю] --> B{Анализ текущей структуры}
    B --> C{Бэкенд: Модель Card уже содержит assigned_agent_id и assigned_agent_name}
    C --> C1[Бэкенд: Обновить модель Agent]
    C1 --> C1.1[Добавить поле 'color' в Agent]
    C1 --> C1.2[Обновить Agent.to_dict() для включения 'color']
    C --> C2[Бэкенд: Обновить API и сервисы Agent]
    C2 --> C2.1[Добавить возможность создания/обновления агентов с цветом]
    C --> D[Фронтенд: Обновить Card.jsx]
    D --> D1[Добавить пропс assignedAgentColor в Card.jsx]
    D --> D2[В StyledCard использовать assignedAgentColor для динамического цвета рамки]
    D --> D3[Добавить стили рамки: 3px solid]
    C --> E[Фронтенд: Обновить Column.jsx]
    E --> E1[Передавать assigned_agent_color из объекта card в Card.jsx]
    E --> G[Тестирование и проверка]
    G --> H[Завершение задачи]