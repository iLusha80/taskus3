# План по удалению атрибута 'status' из модели Card и обновлению логики

## Цель
Удалить дублирующий атрибут `status` из модели `Card` и перенести логику определения статуса карточки на `column_id`, а также обновить соответствующий функционал на фронтенде.

## Предположения
*   Статус карточки определяется колонкой, в которой она находится.
*   "Завершенные" колонки определяются по имени "Готово".

## План действий

### 1. Бэкенд

#### 1.1. Удалить атрибут `status` из модели `Card` в `backend/models/card.py`
*   Удалить строку `status = db.Column(db.Text, default='open')` из определения класса `Card`.
*   Удалить строку `status (str): Текущий статус карточки (например, 'open', 'in progress', 'closed').` из docstring.
*   Удалить строку `'status': self.status,` из метода `to_dict()`.

#### 1.2. Обновить `backend/api/cards.py`
*   Удалить `status = data.get('status', 'open')` при создании карточки.
*   Удалить параметр `status` из вызова `CardService.create_card`.

#### 1.3. Обновить `backend/services/card_service.py`
*   Изменить сигнатуру метода `create_card` (удалить `status`).
*   Удалить все упоминания `status` при создании карточки в `create_card`.
*   В методе `update_card`:
    *   Удалить `old_status = card.status`.
    *   Удалить блок `if 'status' in data and data['status'] != old_status:`.
    *   Удалить логику добавления записи в историю для `status_change`.
*   В методе `_check_and_update_milestone_status`:
    *   Изменить условие `card.status == 'closed'` на проверку, находится ли карточка в колонке с именем "Готово".
    *   Для этого потребуется получить объект `Column` по `card.column_id` и проверить его `name`.
    *   Возможно, потребуется импортировать модель `Column` в `card_service.py`.

### 2. Фронтенд

#### 2.1. Идентифицировать компоненты фронтенда
*   Проверить `frontend-react/src/components/Card.jsx` и `frontend-react/src/pages/BoardPage.jsx` на предмет использования статуса и модальных окон.
*   Проверить `frontend-react/src/components/Modal.jsx` если это общее модальное окно.

#### 2.2. Обновить логику фронтенда
*   Изменить модальное окно, которое ранее позволяло выбирать статус, чтобы оно теперь позволяло перемещать карточку между колонками (изменять `column_id`). Это, скорее всего, будет реализовано через выпадающий список колонок.
*   Обновить отображение статуса карточки на фронтенде, чтобы оно основывалось на `column_id` и имени колонки.

## Диаграмма потока выполнения

```mermaid
graph TD
    A[Начало: Удаление атрибута 'status' из Card] --> D[Изменения на Бэкенде];

    D --> D1[Удалить 'status' из backend/models/card.py];
    D --> D2[Обновить backend/api/cards.py];
    D --> D3[Обновить backend/services/card_service.py];
    D3 --> D3a[Изменить create_card];
    D3 --> D3b[Изменить update_card];
    D3 --> D3c[Изменить _check_and_update_milestone_status и _check_and_update_objective_status];
    D3c --> D3c1[Использовать имя колонки "Готово" для определения завершенности];
    D3c1 --> D3c2[Получить Column по column_id карточки];
    D3c1 --> D3c3[Получить Board по board_id этапа/цели для поиска "Готово" колонки];

    D --> E[Изменения на Фронтенде];
    E --> E1[Идентифицировать компоненты фронтенда];
    E --> E2[Обновить логику фронтенда];
    E2 --> E2a[Изменить модальное окно выбора статуса на выбор колонки];
    E2 --> E2b[Обновить отображение статуса на основе column_id];

    E --> F[Завершение];